{% extends "base.html" %}

{% block content %}

<section class="metal-rates">
    <div class="container">
        <div class="rates-grid">
            {% if rates.gold %}
            <div class="rate-card">
                <div class="rate-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="rate-info">
                    <h3>Gold</h3>
                    <p class="rate-price">₹{{ "%.2f"|format(rates.gold.rate_per_gram) }}/gram</p>
                    <p class="rate-time">
                        {% set time_diff = 30 %}
                        {% if time_diff < 30 %}
                            <span class="rate-fresh">Updated {{ "%.0f"|format(time_diff) }} min ago</span>
                        {% elif time_diff < 120 %}
                            <span class="rate-moderate">Updated {{ "%.0f"|format(time_diff) }} min ago</span>
                        {% else %}
                            <span class="rate-old">Updated {{ "%.0f"|format(time_diff/60) }} hrs ago</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            {% endif %}
            
            {% if rates.silver %}
            <div class="rate-card">
                <div class="rate-icon">
                    <i class="fas fa-medal"></i>
                </div>
                <div class="rate-info">
                    <h3>Silver</h3>
                    <p class="rate-price">₹{{ "%.2f"|format(rates.silver.rate_per_gram) }}/gram</p>
                    <p class="rate-time">
                        {% set time_diff = 45 %}
                        {% if time_diff < 30 %}
                            <span class="rate-fresh">Updated {{ "%.0f"|format(time_diff) }} min ago</span>
                        {% elif time_diff < 120 %}
                            <span class="rate-moderate">Updated {{ "%.0f"|format(time_diff) }} min ago</span>
                        {% else %}
                            <span class="rate-old">Updated {{ "%.0f"|format(time_diff/60) }} hrs ago</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<section class="banner-carousel">
    <div class="container">
        <div class="carousel-container">
            <div class="carousel-slide active">
                <div class="banner-content">
                    <div class="banner-text">
                        <h2>Festive Gold Collection</h2>
                        <p>Up to 20% off on making charges</p>
                        <a href="{{ url_for('shop', category='Gold') }}" class="btn btn-primary">Shop Now</a>
                    </div>
                </div>
            </div>
            <div class="carousel-slide">
                <div class="banner-content">
                    <div class="banner-text">
                        <h2>Diamond Jewelry</h2>
                        <p>Exclusive designs starting from ₹15,000</p>
                        <a href="{{ url_for('shop', category='Diamond') }}" class="btn btn-primary">Explore</a>
                    </div>
                </div>
            </div>
            <div class="carousel-slide">
                <div class="banner-content">
                    <div class="banner-text">
                        <h2>Silver Collection</h2>
                        <p>Free home delivery on orders above ₹5,000</p>
                        <a href="{{ url_for('shop', category='Silver') }}" class="btn btn-primary">View All</a>
                    </div>
                </div>
            </div>
            <div class="carousel-dots">
                <span class="dot active" onclick="currentSlide(1)"></span>
                <span class="dot" onclick="currentSlide(2)"></span>
                <span class="dot" onclick="currentSlide(3)"></span>
            </div>
        </div>
    </div>
</section>

<section class="featured-products">
    <div class="container">
        <h2>New Products</h2>
        <div class="products-grid">
            {% for product in products %}
            <a href="{{ url_for('product_detail', product_id=product.id) }}" class="product-card-link">
            <div class="product-card">
                <div class="product-image">
                    {% if product.image_url %}
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                        <div class="image-placeholder" style="display:none"><i class="fas fa-image"></i><span>No Image</span></div>
                    {% elif product.image and product.image != 'default.jpg' %}
                        <img src="{{ url_for('static', filename='images/products/' + product.image) }}" alt="{{ product.name }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                        <div class="image-placeholder" style="display:none"><i class="fas fa-image"></i><span>No Image</span></div>
                    {% else %}
                        <div class="image-placeholder">
                            <i class="fas fa-image"></i>
                            <span>No Image</span>
                        </div>
                    {% endif %}
                </div>
                <div class="product-info">
                    <h3>{{ product.name }}</h3>
                    <div class="product-details">
                        <p class="product-category">{{ product.category }}</p>
                        {% if product.price_type == 'per_gram' %}
                            <p class="product-metal">{{ product.purity }} {{ product.metal_type|title }} • {{ product.weight_in_grams }}g</p>
                        {% else %}
                            <p class="product-metal">{{ product.purity }} {{ product.metal_type|title }}</p>
                        {% endif %}
                    </div>
                    <div class="product-pricing">
                        <p class="product-price">₹{{ "%.0f"|format(product.calculated_price) }}</p>
                    </div>
                </div>
            </div>
            </a>
            {% endfor %}
        </div>
        <div class="text-center">
            <a href="{{ url_for('shop') }}" class="btn btn-outline">View All Products</a>
        </div>
    </div>
</section>

<script>
let slideIndex = 1;
let slideInterval;

function currentSlide(n) {
    showSlide(slideIndex = n);
    resetInterval();
}

function showSlide(n) {
    const slides = document.querySelectorAll('.carousel-slide');
    const dots = document.querySelectorAll('.dot');
    
    if (n > slides.length) { slideIndex = 1; }
    if (n < 1) { slideIndex = slides.length; }
    
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    slides[slideIndex - 1].classList.add('active');
    dots[slideIndex - 1].classList.add('active');
}

function nextSlide() {
    showSlide(slideIndex += 1);
}

function resetInterval() {
    clearInterval(slideInterval);
    slideInterval = setInterval(nextSlide, 4000);
}

document.addEventListener('DOMContentLoaded', function() {
    showSlide(slideIndex);
    slideInterval = setInterval(nextSlide, 4000);
});

function searchProducts() {
    const searchTerm = document.getElementById('homeSearchInput').value.toLowerCase();
    if (searchTerm.length > 0) {
        window.location.href = `/shop?search=${encodeURIComponent(searchTerm)}`;
    }
}

if (document.getElementById('homeSearchInput')) {
    document.getElementById('homeSearchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchProducts();
        }
    });
}
</script>
{% endblock %}
