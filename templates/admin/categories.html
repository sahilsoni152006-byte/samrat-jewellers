{% extends "admin/base.html" %}

{% block title %}Manage Categories{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Manage Categories</h1>
    <button onclick="showAddModal()" class="btn btn-primary">Add Category</button>
</div>

<div class="admin-content">
    <div class="categories-list">
        {% for category in categories %}
        <div class="category-item">
            <div class="category-preview">
                {% if category.image_url %}
                    <img src="{{ category.image_url }}" alt="{{ category.name }}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                {% else %}
                    <div class="no-image">No Image</div>
                {% endif %}
            </div>
            <div class="category-info">
                <h3>{{ category.name }}</h3>
                <p>Status: {% if category.is_hidden %}Hidden{% else %}Visible{% endif %}</p>
            </div>
            <div class="category-actions">
                <button onclick="editCategory('{{ category.id }}', '{{ category.name }}', '{{ category.image_url or '' }}')" class="btn btn-primary">Edit</button>
                <button onclick="toggleCategory('{{ category.id }}')" class="btn {% if category.is_hidden %}btn-success{% else %}btn-warning{% endif %}">
                    {% if category.is_hidden %}Show{% else %}Hide{% endif %}
                </button>
                <button onclick="deleteCategory('{{ category.id }}')" class="btn btn-danger">Delete</button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Add Category Modal -->
<div id="addModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3>Add Category</h3>
        <form onsubmit="addCategory(event)">
            <div class="form-group">
                <label>Category Name:</label>
                <input type="text" id="addCategoryName" required>
            </div>
            <div class="form-group">
                <label>Google Drive Image URL:</label>
                <input type="url" id="addCategoryImageUrl" placeholder="https://drive.google.com/...">
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Add</button>
                <button type="button" onclick="closeAddModal()" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Category Modal -->
<div id="editModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3>Edit Category</h3>
        <form onsubmit="updateCategory(event)">
            <input type="hidden" id="categoryId">
            <div class="form-group">
                <label>Category Name:</label>
                <input type="text" id="categoryName" required>
            </div>
            <div class="form-group">
                <label>Google Drive Image URL:</label>
                <input type="url" id="categoryImageUrl" placeholder="https://drive.google.com/...">
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Update</button>
                <button type="button" onclick="closeEditModal()" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddModal() {
    document.getElementById('addModal').style.display = 'block';
}

function closeAddModal() {
    document.getElementById('addModal').style.display = 'none';
}

function addCategory(event) {
    event.preventDefault();
    const name = document.getElementById('addCategoryName').value;
    const imageUrl = document.getElementById('addCategoryImageUrl').value;
    
    fetch('/admin/categories/add', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name: name, image_url: imageUrl})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message || 'Error adding category');
        }
    });
}

function editCategory(id, name, imageUrl) {
    document.getElementById('categoryId').value = id;
    document.getElementById('categoryName').value = name;
    document.getElementById('categoryImageUrl').value = imageUrl;
    document.getElementById('editModal').style.display = 'block';
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

function updateCategory(event) {
    event.preventDefault();
    const categoryId = document.getElementById('categoryId').value;
    const name = document.getElementById('categoryName').value;
    const imageUrl = document.getElementById('categoryImageUrl').value;
    
    fetch(`/admin/categories/edit/${categoryId}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name: name, image_url: imageUrl})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message || 'Error updating category');
        }
    });
}

function toggleCategory(id) {
    fetch(`/admin/categories/toggle/${id}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error toggling category');
        }
    });
}

function deleteCategory(id) {
    if (confirm('Are you sure you want to delete this category?')) {
        fetch(`/admin/categories/delete/${id}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error deleting category');
            }
        });
    }
}
</script>

<style>
.categories-list {
    display: grid;
    gap: 20px;
}

.category-item {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.category-info {
    flex: 1;
}

.category-actions {
    display: flex;
    gap: 10px;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.no-image {
    width: 80px;
    height: 80px;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    color: #666;
}

.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
}

.modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 30px;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
}
</style>
{% endblock %}